# GitHub Changelog Video Generation Architecture

## Vision
Automatically generate motion graphic videos from GitHub PRs that:
1. **For Bazaar**: Auto-generate changelog videos for our own product
2. **As a Service**: Allow any GitHub repo to tag `@bazaar-vid` to generate changelog videos

## System Architecture

### Phase 1: MVP - GitHub App Integration

#### 1.1 GitHub App Setup
```typescript
// GitHub App Configuration
{
  name: "bazaar-changelog",
  permissions: {
    pull_requests: "read",
    contents: "read",
    issues: "write", // To comment with video links
    metadata: "read"
  },
  events: [
    "pull_request.opened",
    "pull_request.merged",
    "pull_request.synchronize"
  ]
}
```

#### 1.2 Webhook Endpoint
```typescript
// /api/webhooks/github/route.ts
POST /api/webhooks/github
- Verify GitHub signature
- Parse PR event
- Queue video generation job
- Return 200 immediately (async processing)
```

#### 1.3 PR Analysis Pipeline
```typescript
interface PRAnalysis {
  title: string;
  description: string;
  files: {
    path: string;
    additions: number;
    deletions: number;
    patch: string;
  }[];
  commits: {
    message: string;
    author: string;
  }[];
  changeType: 'feature' | 'fix' | 'refactor' | 'docs' | 'style';
  techStack: string[]; // Detected from package.json, requirements.txt, etc.
  brandAssets?: {
    logo?: string;
    colors?: string[];
    fonts?: string[];
  };
}
```

### Phase 2: Video Generation System

#### 2.1 Changelog Templates
```typescript
// New templates specifically for changelogs
interface ChangelogTemplate {
  id: string;
  name: string;
  type: 'feature' | 'fix' | 'improvement' | 'breaking';
  style: 'minimal' | 'branded' | 'animated';
  components: {
    title: React.ComponentType;
    description: React.ComponentType;
    codePreview?: React.ComponentType;
    metrics?: React.ComponentType;
  };
}

// Example templates:
- "Feature Announcement" - Exciting new feature reveal
- "Bug Fix Notice" - Clean fix explanation
- "Performance Update" - Before/after metrics
- "Breaking Change" - Important migration guide
```

#### 2.2 Brand Detection Service
```typescript
class BrandDetector {
  async detectFromRepo(owner: string, repo: string): Promise<BrandProfile> {
    // 1. Check for brand config file (.bazaar-brand.json)
    // 2. Analyze README for logo/images
    // 3. Extract colors from CSS/theme files
    // 4. Detect fonts from stylesheets
    // 5. Analyze existing UI screenshots
    
    return {
      primaryColor: '#000000',
      secondaryColor: '#ffffff',
      logo: 'url-to-logo',
      font: 'Inter',
      style: 'modern' | 'playful' | 'corporate'
    };
  }
}
```

#### 2.3 Content Generator
```typescript
class ChangelogContentGenerator {
  async generateFromPR(analysis: PRAnalysis, brand: BrandProfile): Promise<VideoScene> {
    // Use AI to:
    // 1. Summarize changes in user-friendly language
    // 2. Extract key highlights
    // 3. Create visual representation of code changes
    // 4. Generate appropriate animations
    
    const prompt = `
      Create a 15-30 second motion graphic video script for:
      ${analysis.title}
      
      Changes: ${analysis.description}
      Type: ${analysis.changeType}
      Brand: ${brand.style}
      
      Include:
      - Engaging opening
      - Clear explanation of the change
      - Visual demonstration if applicable
      - Call-to-action or next steps
    `;
    
    return await generateSceneFromPrompt(prompt);
  }
}
```

### Phase 3: Distribution System

#### 3.1 Changelog Website
```typescript
// /changelog/[owner]/[repo]/page.tsx
interface ChangelogEntry {
  id: string;
  prNumber: number;
  title: string;
  description: string;
  videoUrl: string;
  thumbnailUrl: string;
  mergedAt: Date;
  author: {
    name: string;
    avatar: string;
  };
  type: 'feature' | 'fix' | 'improvement';
  version?: string;
}

// Beautiful changelog display with:
- Video player for each entry
- Filter by type/date
- RSS feed
- Embed codes
```

#### 3.2 GitHub Bot Comments
```typescript
class GitHubBot {
  async commentOnPR(owner: string, repo: string, prNumber: number, videoUrl: string) {
    await octokit.issues.createComment({
      owner,
      repo,
      issue_number: prNumber,
      body: `
## ðŸŽ¬ Changelog Video Generated!

Your changes have been automatically documented in a motion graphic video:

[![Watch Video](${thumbnailUrl})](${videoUrl})

**View in changelog:** https://bazaar.video/changelog/${owner}/${repo}#pr-${prNumber}

**Embed in your README:**
\`\`\`markdown
[![Latest Changes](https://bazaar.video/badge/${owner}/${repo})](https://bazaar.video/changelog/${owner}/${repo})
\`\`\`

---
*Generated by [Bazaar Changelog](https://bazaar.video) - Beautiful changelogs that ship themselves*
      `
    });
  }
}
```

### Phase 4: Integration Points

#### 4.1 Installation Flow
1. **GitHub Marketplace**: Install Bazaar Changelog app
2. **Configuration**: 
   ```json
   // .github/bazaar.json
   {
     "changelog": {
       "enabled": true,
       "triggers": ["merge", "release"],
       "style": "branded",
       "videoFormat": "landscape",
       "autoDeploy": true,
       "deployTo": "https://oursite.com/changelog"
     },
     "brand": {
       "logo": "./assets/logo.svg",
       "primaryColor": "#007AFF",
       "font": "SF Pro Display"
     }
   }
   ```
3. **Automatic Detection**: Works without config using smart defaults

#### 4.2 Trigger Methods
1. **Automatic on Merge**: Generate when PR is merged
2. **Manual Trigger**: Comment `@bazaar-vid generate changelog`
3. **Release Tags**: Auto-generate for new releases
4. **API**: Direct API calls for CI/CD integration

#### 4.3 Output Formats
- **Video File**: MP4 hosted on R2
- **GIF**: For README embedding
- **Social Cards**: Auto-sized for Twitter/LinkedIn
- **Changelog Page**: Hosted on bazaar.video
- **API Response**: JSON with all assets

## Implementation Roadmap

### Sprint 74 - Week 1: Foundation
- [ ] Create GitHub App
- [ ] Setup webhook endpoint
- [ ] Implement PR analysis
- [ ] Create changelog-specific templates

### Sprint 74 - Week 2: Generation
- [ ] Build brand detection service
- [ ] Implement changelog content generator
- [ ] Create video generation pipeline
- [ ] Setup R2 storage for videos

### Sprint 75 - Week 1: Distribution
- [ ] Build changelog website
- [ ] Implement GitHub bot comments
- [ ] Create embeddable widgets
- [ ] Setup CDN for videos

### Sprint 75 - Week 2: Polish
- [ ] Add configuration options
- [ ] Create onboarding flow
- [ ] Build analytics dashboard
- [ ] Launch on GitHub Marketplace

## Technical Considerations

### Performance
- Queue-based processing with BullMQ
- Parallel video generation
- CDN distribution
- Caching of brand assets

### Security
- Verify GitHub webhooks
- Rate limiting per repository
- Sandboxed code execution
- Private repo support with auth

### Scalability
- Serverless webhook handlers
- Lambda for video rendering
- R2 for unlimited storage
- Edge caching for playback

## Success Metrics
- Time from PR merge to video: < 2 minutes
- Video quality score: > 90%
- GitHub Marketplace installs: 1000+ in first month
- Changelog page views: 10x PR views

## Competitive Advantages
1. **Automatic**: No manual work required
2. **Branded**: Matches company style automatically
3. **Engaging**: Motion graphics vs static text
4. **Shareable**: Perfect for social media
5. **Integrated**: Lives where developers work

## Example Use Cases

### For Bazaar
- Every merged PR gets a video
- Weekly digest videos
- Release announcement videos
- Feature spotlight videos

### For Users
- **Open Source Projects**: Beautiful changelogs increase engagement
- **SaaS Products**: Customer-facing update videos
- **Internal Tools**: Team update videos
- **API Libraries**: Visual breaking change guides

## Next Steps
1. Create GitHub App registration
2. Setup webhook infrastructure
3. Design changelog templates
4. Build MVP for Bazaar's own repo
5. Expand to public beta