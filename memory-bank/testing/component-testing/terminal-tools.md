//memory-bank/testing/component-testing/terminal-tools.md
# Terminal-Based Component Testing Tools

This document describes the terminal-based tools for testing Remotion components in the Bazaar-Vid platform. These tools complement the browser-based testing interfaces by providing command-line options for automated and batch testing.

## Available Tools

### 1. Single Component Testing

- **Path**: `src/scripts/test-components/test-component.ts`
- **Purpose**: Test a single component file from the terminal

This tool allows you to compile and test a single TSX component file directly from the command line, generating an HTML file for preview.

#### Usage

```bash
# Run with ts-node
npx ts-node src/scripts/test-components/test-component.ts --input=/path/to/your/component.tsx --output=/path/to/output

# Optional parameters
# --width=1920 --height=1080 --duration=150 --background=#000000
```

#### How It Works

1. Reads the TSX file from the input path
2. Compiles it using the same esbuild configuration as the production pipeline
3. Generates an HTML file with embedded JavaScript that:
   - Creates a Remotion Player with the compiled component
   - Provides playback controls
   - Includes error reporting
4. Opens the HTML file in your default browser (if the `--open` flag is used)

#### Example Output

The tool generates an HTML file that looks like this:

```html
<!DOCTYPE html>
<html>
<head>
  <title>Component Test - MyComponent.tsx</title>
  <style>/* Embedded CSS for player controls */</style>
</head>
<body>
  <div id="player-container"></div>
  <div id="error-container"></div>
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@remotion/player@3.3.80/dist/index.js"></script>
  <script>
    // Embedded compiled component code
  </script>
  <script>
    // Player initialization code
  </script>
</body>
</html>
```

### 2. Batch Component Testing

- **Path**: `src/scripts/test-components/batch-test-components.ts`
- **Purpose**: Process multiple components at once, generating a gallery of results

This tool is particularly useful for testing a directory of components, such as those generated by an LLM, or for creating test galleries for component libraries.

#### Usage

```bash
# Run with ts-node
npx ts-node src/scripts/test-components/batch-test-components.ts --input=/path/to/components --output=/path/to/output

# Optional parameters
# --filter=*.tsx --exclude=node_modules --generate-index=true
```

#### How It Works

1. Scans the input directory for TSX files matching the filter
2. Processes each file:
   - Compiles the component
   - Generates an individual HTML preview
   - Captures any errors
3. Creates an index.html file with:
   - Links to all component previews
   - Thumbnails (if enabled)
   - Error summaries
   - Success/failure indicators

#### Output Structure

```
output/
├── index.html                  # Main gallery page
├── component1/
│   ├── component.html          # Individual component preview
│   ├── component.js            # Compiled JavaScript
│   ├── component.tsx           # Original source
│   └── thumbnail.png           # Preview image (if enabled)
├── component2/
│   ├── ...
...
```

## Integration with CI/CD

These tools can be integrated into your CI/CD pipeline to automate component testing:

```yaml
# Example GitHub Actions workflow
jobs:
  test-components:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: npm install
      - name: Test components
        run: |
          npx ts-node src/scripts/test-components/batch-test-components.ts \
            --input=./src/components/test \
            --output=./test-results \
            --generate-index=true
      - name: Upload test results
        uses: actions/upload-artifact@v2
        with:
          name: component-test-results
          path: ./test-results
```

## Customization

Both tools support customization through command-line parameters and configuration files:

### Command-Line Parameters

- `--input`: Input file or directory path
- `--output`: Output directory path
- `--width`: Composition width (default: 1920)
- `--height`: Composition height (default: 1080)
- `--duration`: Composition duration in frames (default: 150)
- `--background`: Background color (default: #000000)
- `--fps`: Frames per second (default: 30)
- `--open`: Open output in browser (single component tool only)
- `--generate-thumbnails`: Generate preview images (batch tool only)
- `--filter`: File pattern to include (batch tool only)
- `--exclude`: File pattern to exclude (batch tool only)

### Configuration File

You can also create a `component-test-config.json` file in your project root:

```json
{
  "defaultWidth": 1920,
  "defaultHeight": 1080,
  "defaultDuration": 150,
  "defaultBackground": "#000000",
  "defaultFps": 30,
  "thumbnailSize": {
    "width": 320,
    "height": 180
  },
  "excludePatterns": ["**/node_modules/**", "**/.git/**"],
  "externalDependencies": [
    "react",
    "react-dom",
    "remotion",
    "@remotion/*"
  ]
}
```

## Troubleshooting

### Common Issues

1. **Module Resolution Errors**
   - Make sure all dependencies are installed
   - Check for path issues in imports

2. **Rendering Errors**
   - Look for React key warnings
   - Check for missing Remotion components

3. **Performance Issues**
   - Large component files may take longer to compile
   - Complex animations may strain browser performance

### Logs

Both tools generate detailed logs in the console and in the output directory:

```
output/
├── logs/
│   ├── compilation.log
│   ├── errors.log
│   └── summary.json
```

Use these logs to diagnose issues with specific components or the compilation process.

## Next Steps

- [ ] Add support for component screenshots/thumbnails
- [ ] Implement video export functionality
- [ ] Add performance metrics collection
- [ ] Create comparison reporting between component versions
